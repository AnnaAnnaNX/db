(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b2c81"],{2629:function(e,o,r){"use strict";r.r(o);var t=function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("div",[r("h3",[e._v("Основной ассортимент")]),e.tableInfo&&e.tableInfo.rows?r("v-data-table",{attrs:{headers:e.headers,items:e.tableInfo.rows},scopedSlots:e._u([{key:"item.id",fn:function(o){var t=o.item;return[t.id?r("div",[e._v(" "+e._s(t.id)+" ")]):r("div",[r("v-select",{attrs:{items:["New"].concat(e.mainProducts.map((function(e){return e.id}))),label:"Связать"},on:{change:function(o){e.select(o,t)}}})],1)]}}],null,!1,3933829408)}):e._e(),null!==e.error?r("div",[e._v("Error - "+e._s(e.error))]):e._e()],1)},i=[],a=r("2909"),d=r("5530"),n=(r("d81d"),r("159b"),r("d3b7"),r("ddb0"),r("b64b"),r("99af"),r("bc3a")),s=r.n(n),c={name:"MainAssortiment",components:{},data:function(){return{providerProducts:null,mainProducts:null,providers:null,error:null,shortListHeaders:!0,showNotLinkedProduct:null}},computed:{tableInfo:function(){if(!this.mainProducts||!this.providerProducts||!this.providers)return null;var e=this.mainProducts.map((function(e){return e.id})),o={};e.forEach((function(e){o[e]={}}));var r={};this.providers.forEach((function(e){e.id&&(r[e.nameProvider]={id:e.id,fieldsNames:e.fieldsNames&&JSON.parse(e.fieldsNames)})}));var t={};this.providers.forEach((function(e){e.id&&e.nameProvider&&(t[e.id]=e.nameProvider)})),this.providerProducts.forEach((function(e){if(e.idMainProduct)if(r["YM"]&&e.idProvider===r["YM"].id){o[e.idMainProduct]["YMId"]=e.idProductProvider;var i=r["YM"].fieldsNames,a=i.indexOf("name"),d=e.values&&JSON.parse(e.values);o[e.idMainProduct]["YMName"]=d&&d[a]}else if(r["Ozon"]&&e.idProvider===r["Ozon"].id){o[e.idMainProduct]["OzonId"]=e.idProductProvider;var n=r["Ozon"].fieldsNames,s=n.indexOf("name"),c=e.values&&JSON.parse(e.values);o[e.idMainProduct]["OzonName"]=c&&c[s]}else if(r["1C"]&&e.idProvider===r["1C"].id){o[e.idMainProduct]["1CId"]=e.idProductProvider;var l=e.values&&JSON.parse(e.values),u=r["1C"].fieldsNames,p=u.indexOf("name");o[e.idMainProduct]["1CName"]=l&&l[p],p=u.indexOf("price"),o[e.idMainProduct]["1CPrice"]=l&&l[p],o[e.idMainProduct]["1CUpdate"]=e.updatedAt}else if(r["markup"]&&e.idProvider===r["markup"].id){o[e.idMainProduct]["markupId"]=e.idProductProvider;var v=e.values&&JSON.parse(e.values),f=r["markup"].fieldsNames,h=f.indexOf("markup");o[e.idMainProduct]["markup"]=v&&v[h]}else if(!o[e.idMainProduct]["providerName"]){console.log("el.idProvider"),console.log(e.idProvider);var P=t[e.idProvider];console.log("providerName"),console.log(P),o[e.idMainProduct]["providerName"]=P;var m=r[P]&&r[P].fieldsNames,N=m&&m.indexOf("name"),O=e.values&&JSON.parse(e.values);o[e.idMainProduct]["providerProductName"]=O&&O[N],N=m&&m.indexOf("price"),o[e.idMainProduct]["providerProductprice"]=O&&O[N],o[e.idMainProduct]["providerProductUpdate"]=e.updatedAt}}));var i=Object.keys(o).map((function(e){return Object(d["a"])({id:e},o[e])}));console.log("rows"),console.log(i);var a=["YMId","YMName","OzonId","OzonName","1CId","1CName","1CPrice","1CUpdate","markupId","markup","providerName","providerProductName","providerProductprice","providerProductUpdate"];return{rows:i,shortListHeaders:["id"].concat(a)}},headers:function(){if(!this.tableInfo)return null;var e=this.tableInfo.shortListHeaders;return e.map((function(e){return{text:e,align:"start",value:e}}))}},mounted:function(){var e=this;console.log("MOUNTED"),this.products=null,this.error=null,s.a.get("http://localhost:3000/api/getProviderProducts").then((function(o){console.log("SUCCESS"),o&&o.data&&o.data.data&&(e.providerProducts=o.data.data)})).catch((function(){console.log("ERROR"),e.providerProducts=null})),s.a.get("http://localhost:3000/api/getMainProducts").then((function(o){console.log("SUCCESS"),o&&o.data&&o.data.data&&(e.mainProducts=o.data.data)})).catch((function(){console.log("ERROR"),e.mainProducts=null})),s.a.get("http://localhost:3000/api/getProviders",{headers:{"Content-Type":"multipart/form-data"}}).then((function(o){o&&o.data&&o.data.data&&(e.providers=o.data.data)})).catch((function(){console.log("ERROR"),e.providers=null}))},methods:{handleFileUpload:function(){this.file=this.$refs.file.files[0]},select:function(e,o){if(console.log(e),console.log(o),!this.showNotLinkedProduct)return"error";var r=o["id #".concat(this.showNotLinkedProduct)],t=this.showNotLinkedProduct,i={idProductProvider:r,idProvider:t};"New"!==e&&(i.idMainProduct=e),s.a.post("http://localhost:3000/api/addLink",i,{headers:{"Content-Type":"application/json"}}).then((function(){console.log("SUCCESS"),alert("Связан")})).catch((function(){console.log("ERROR"),alert("Ошибка")}))},writeRowsInExcel:function(){s.a.post("http://localhost:3000/api/writeRowsInExcel",{headers:this.headers,rows:[].concat(Object(a["a"])(this.tableInfo.rows),Object(a["a"])(this.tableInfo.notLinkedRows))},{headers:{"Content-Type":"application/json"}}).then((function(){console.log("SUCCESS")})).catch((function(){console.log("ERROR")}))}}},l=c,u=r("2877"),p=r("6544"),v=r.n(p),f=r("8fea"),h=r("b974"),P=Object(u["a"])(l,t,i,!1,null,null,null);o["default"]=P.exports;v()(P,{VDataTable:f["a"],VSelect:h["a"]})}}]);
//# sourceMappingURL=chunk-2d0b2c81.74e343b7.js.map