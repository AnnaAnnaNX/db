{"version":3,"sources":["webpack:///./src/views/ShowAllProducts.vue?d8c3","webpack:///src/views/ShowAllProducts.vue","webpack:///./src/views/ShowAllProducts.vue?afff","webpack:///./src/views/ShowAllProducts.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","_v","model","value","callback","$$v","shortListHeaders","expression","showNotLinkedProduct","attrs","_l","provider","key","id","tableInfo","rows","headers","concat","notLinkedRows","scopedSlots","_u","fn","ref","item","_s","mainProducts","map","el","on","val","select","_e","error","writeRowsInExcel","staticRenderFns","name","components","data","providerProducts","providers","computed","mainIds","forEach","idMainProduct","obj","idProductProvider","includes","title","push","price","count","fulllListHeaders","list","mounted","console","log","products","methods","handleFileUpload","file","$refs","files","row","idProvider","component","VBtn","VCol","VDataTable","VRadio","VRadioGroup","VRow","VSelect","VSwitch"],"mappings":"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","file":"js/chunk-2d0b236a.00e5af46.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-row',[_c('v-col',[_c('p',[_vm._v(\"Показывать непустые столбцы\")]),_c('div',[_c('v-switch',{model:{value:(_vm.shortListHeaders),callback:function ($$v) {_vm.shortListHeaders=$$v},expression:\"shortListHeaders\"}})],1)]),_c('v-col',[_c('p',[_vm._v(\"Отображать товары не основного ассортимента для сопоставления\")]),_c('v-radio-group',{model:{value:(_vm.showNotLinkedProduct),callback:function ($$v) {_vm.showNotLinkedProduct=$$v},expression:\"showNotLinkedProduct\"}},[_c('v-radio',{attrs:{\"value\":null,\"label\":\"не показывать\"}}),_vm._l((_vm.providers),function(provider){return _c('v-radio',{key:provider.id,attrs:{\"value\":provider.id,\"label\":((provider.nameProvider) + \" #\" + (provider.id))}})})],2)],1)],1),(_vm.tableInfo && _vm.tableInfo.rows)?_c('v-data-table',{attrs:{\"headers\":_vm.headers,\"items\":_vm.tableInfo.rows.concat( _vm.tableInfo.notLinkedRows)},scopedSlots:_vm._u([{key:\"item.id\",fn:function(ref){\nvar item = ref.item;\nreturn [(item.id)?_c('div',[_vm._v(\" \"+_vm._s(item.id)+\" \")]):_c('div',[_c('v-select',{attrs:{\"items\":['New' ].concat( _vm.mainProducts.map(function (el) { return (el.id); })),\"label\":\"Связать\"},on:{\"change\":function (val) {_vm.select(val, item)}}})],1)]}}],null,false,3933829408)}):_vm._e(),(_vm.error !== null)?_c('div',[_vm._v(\"Error - \"+_vm._s(_vm.error))]):_vm._e(),_c('v-btn',{attrs:{\"color\":\"primary\"},on:{\"click\":_vm.writeRowsInExcel}},[_vm._v(\"Выгрузить в Excel\")]),_vm._v(\" 11111 \")],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <v-row>\n      <v-col>\n        <p>Показывать непустые столбцы</p>\n        <div>\n          <v-switch\n            v-model=\"shortListHeaders\"\n          ></v-switch>\n        </div>\n      </v-col>\n      <v-col>\n        <p>Отображать товары не основного ассортимента для сопоставления</p>\n        <v-radio-group v-model=\"showNotLinkedProduct\">\n          <v-radio\n            :value=\"null\"      \n            label=\"не показывать\"\n          ></v-radio>\n          <v-radio\n            v-for=\"provider in providers\"\n            :key=\"provider.id\"\n            :value=\"provider.id\"      \n            :label=\"`${provider.nameProvider} #${provider.id}`\"\n          ></v-radio>\n        </v-radio-group>\n      </v-col>\n    </v-row>\n    <v-data-table\n      v-if=\"tableInfo && tableInfo.rows\"\n      :headers=\"headers\"\n      :items=\"[...tableInfo.rows, ...tableInfo.notLinkedRows]\"\n    >\n      <template v-slot:item.id=\"{ item }\">\n        <div v-if=\"item.id\">\n          {{ item.id }}\n        </div>\n        <div v-else>\n          <v-select\n            :items=\"['New', ...mainProducts.map((el) => (el.id))]\"\n            label=\"Связать\"\n            @change=\"(val) => {select(val, item)}\"\n          ></v-select>\n        </div>\n      </template>\n    </v-data-table>\n    <div v-if=\"error !== null\">Error - {{ error }}</div>\n    <v-btn @click=\"writeRowsInExcel\" color=\"primary\">Выгрузить в Excel</v-btn>\n    11111\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\n\nexport default {\n  name: \"ShowAllProducts\",\n  components: {},\n  data() {\n    return {\n      providerProducts: null,\n      mainProducts: null,\n      providers: null,\n      error: null,\n      shortListHeaders: true,\n      showNotLinkedProduct: null\n    };\n  },\n  // column name - <имя поля> #<idProvider>\n  computed: {\n    // headers\n    tableInfo() {\n      if (!this.mainProducts || !this.providerProducts || !this.providers) {\n        return null;\n      }\n      const mainIds = this.mainProducts.map((el) => (el.id));\n      const obj = {};\n      mainIds.forEach((el) => {obj[el] = {}});\n      const shortListHeaders = []; \n      this.providerProducts.forEach((el) => {\n        if (el.idMainProduct) {\n          const idMainProduct = el.idMainProduct;\n          if (!obj[idMainProduct]) {\n            obj[idMainProduct] = {};\n          }\n          if (el.idProductProvider) {\n            const title = `id #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`id #${el.idProvider}`);\n            }\n            obj[idMainProduct][`id #${el.idProvider}`] = el.idProductProvider;\n          }\n          if (el.name) {\n            const title = `name #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`name #${el.idProvider}`);\n            }\n            obj[idMainProduct][`name #${el.idProvider}`] = el.name;\n          }\n          if (el.price) {\n            const title = `price #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`price #${el.idProvider}`);\n            }\n            obj[idMainProduct][`price #${el.idProvider}`] = el.price;\n          }\n          if (el.count) {\n            const title = `count #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`count #${el.idProvider}`);\n            }\n            obj[idMainProduct][`count #${el.idProvider}`] = el.count;\n          }\n        }\n      });\n      const rows = Object.keys(obj).map((id) => ({id: id, ...obj[id]}));\n      let notLinkedRows = [];\n      if (this.showNotLinkedProduct) {\n        notLinkedRows = this.providerProducts\n          .filter((el) => (el.idProvider === this.showNotLinkedProduct))\n          .map((el) => {\n            const obj = {};\n            if (el.idProductProvider) {\n            const title = `id #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`id #${el.idProvider}`);\n            }\n            obj[`id #${el.idProvider}`] = el.idProductProvider;\n          }\n            if (el.name) {\n            const title = `name #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`name #${el.idProvider}`);\n            }\n            obj[`name #${el.idProvider}`] = el.name;\n          }\n          if (el.price) {\n            const title = `price #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`price #${el.idProvider}`);\n            }\n            obj[`price #${el.idProvider}`] = el.price;\n          }\n          if (el.count) {\n            const title = `count #${el.idProvider}`; \n            if (!shortListHeaders.includes(title)) {\n              shortListHeaders.push(`count #${el.idProvider}`);\n            }\n            obj[`count #${el.idProvider}`] = el.count;\n          }\n          return obj;\n        })\n      }\n\n      const fulllListHeaders = [];\n      this.providers.forEach((el) => {\n        const id = el.id;\n        fulllListHeaders.push(`name #${id}`);\n        fulllListHeaders.push(`price #${id}`);\n        fulllListHeaders.push(`count #${id}`);\n      });\n\n      return {\n        rows,\n        notLinkedRows,\n        shortListHeaders: ['id', ...shortListHeaders],\n        fulllListHeaders: ['id', ...fulllListHeaders]\n      };\n    },\n    headers() {\n      if (!this.tableInfo) {\n        return null;\n      }\n      let list = null;\n      if (this.shortListHeaders) {\n        list = this.tableInfo.shortListHeaders;\n      } else {\n        list = this.tableInfo.fulllListHeaders;\n      }\n      return list.map((el) => ({\n        text: el,\n        align: 'start',\n        value: el,\n      }));\n    }\n  },\n  mounted() {\n    console.log(\"MOUNTED\");\n    this.products = null;\n    this.error = null;\n    axios\n      .get(\"http://localhost:3000/api/getProviderProducts\")\n      .then((result) => {\n        console.log(\"SUCCESS\");\n        if (result && result.data && result.data.data) {\n          this.providerProducts = result.data.data;\n        }\n      })\n      .catch(() => {\n        console.log(\"ERROR\");\n        this.providerProducts = null;\n      });\n    axios\n      .get(\"http://localhost:3000/api/getMainProducts\")\n      .then((result) => {\n        console.log(\"SUCCESS\");\n        if (result && result.data && result.data.data) {\n          this.mainProducts = result.data.data;\n        }\n      })\n      .catch(() => {\n        console.log(\"ERROR\");\n        this.mainProducts = null;\n      });\n    axios\n      .get(\"http://localhost:3000/api/getProviders\", {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n        },\n      })\n      .then((result) => {\n        if (\n          result &&\n          result.data && \n          result.data.data\n        ) {\n          this.providers = result.data.data;\n        }\n      })\n      .catch(() => {\n        console.log(\"ERROR\");\n        this.providers = null;\n      });\n  },\n  methods: {\n    handleFileUpload() {\n      this.file = this.$refs.file.files[0];\n    },\n    select(val, row) {\n      console.log(val);\n      console.log(row);\n    //  idProvider || !idProductProvider || !idMainProduct\n      if (!this.showNotLinkedProduct) {\n        return 'error';\n      }\n      const idProductProvider = row[`id #${this.showNotLinkedProduct}`];\n      const idProvider = this.showNotLinkedProduct;\n      const obj = {\n        idProductProvider,\n        idProvider,\n      };\n      if (val !== 'New') {\n        obj.idMainProduct = val;\n      }\n      axios\n        .post(\"http://localhost:3000/api/addLink\", obj, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        })\n        .then(() => {\n          console.log(\"SUCCESS\");\n          alert('Связан');\n        })\n        .catch(() => {\n          console.log(\"ERROR\");\n          alert('Ошибка');\n        });\n    },\n    writeRowsInExcel() {\n      axios\n        .post(\"http://localhost:3000/api/writeRowsInExcel\", \n        { \n          headers: this.headers,\n          rows: [\n            ...this.tableInfo.rows, \n            ...this.tableInfo.notLinkedRows\n          ]\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        })\n        .then(() => {\n          console.log(\"SUCCESS\");\n        })\n        .catch(() => {\n          console.log(\"ERROR\");\n        });\n    }\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ShowAllProducts.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ShowAllProducts.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ShowAllProducts.vue?vue&type=template&id=9deef864&\"\nimport script from \"./ShowAllProducts.vue?vue&type=script&lang=js&\"\nexport * from \"./ShowAllProducts.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VRadio } from 'vuetify/lib/components/VRadioGroup';\nimport { VRadioGroup } from 'vuetify/lib/components/VRadioGroup';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VSwitch } from 'vuetify/lib/components/VSwitch';\ninstallComponents(component, {VBtn,VCol,VDataTable,VRadio,VRadioGroup,VRow,VSelect,VSwitch})\n"],"sourceRoot":""}