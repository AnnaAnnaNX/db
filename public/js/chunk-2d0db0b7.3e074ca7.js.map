{"version":3,"sources":["webpack:///./src/views/AddAllProducts.vue?8f8a","webpack:///src/views/AddAllProducts.vue","webpack:///./src/views/AddAllProducts.vue?e85b","webpack:///./src/views/AddAllProducts.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","_v","attrs","providers","on","reset","model","value","callback","$$v","idProvider","expression","ref","$event","handleFileUpload","staticClass","file","submitFile","_s","showStatus","headers","contentFile","_e","save","saveStatus","staticRenderFns","name","components","data","readFromFile","added","error","computed","provider","forEach","obj","id","fields","map","mounted","methods","$refs","files","console","log","formData","append","component","VBtn","VDataTable","VSelect"],"mappings":"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","file":"js/chunk-2d0db0b7.3e074ca7.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('h3',[_vm._v(\"Загрузить товары\")]),_c('div',[_c('div',[_c('v-select',{attrs:{\"items\":_vm.providers,\"item-text\":\"nameProvider\",\"item-value\":\"id\",\"persistent-hint\":\"\",\"return-object\":\"\",\"single-line\":\"\",\"label\":\"Провайдер\"},on:{\"change\":_vm.reset},model:{value:(_vm.idProvider),callback:function ($$v) {_vm.idProvider=$$v},expression:\"idProvider\"}})],1),_c('label',[_vm._v(\"File \"),_c('input',{ref:\"file\",attrs:{\"type\":\"file\",\"id\":\"file\"},on:{\"change\":function($event){return _vm.handleFileUpload($event)}}})]),_c('div',{staticClass:\"my-10\"},[_c('v-btn',{attrs:{\"disabled\":!this.file},on:{\"click\":function($event){return _vm.submitFile()}}},[_vm._v(\"Submit\")]),_vm._v(\" \"+_vm._s(_vm.showStatus)+\" \")],1)]),(_vm.contentFile)?_c('div',[_c('h3',[_vm._v(\"Products from files\")]),_c('div',[(_vm.idProvider && _vm.headers && _vm.contentFile)?_c('v-data-table',{staticClass:\"elevation-1\",attrs:{\"headers\":_vm.headers,\"items\":_vm.contentFile,\"items-per-page\":5}}):_vm._e()],1),_c('v-btn',{staticClass:\"mt-10\",attrs:{\"color\":\"primary\"},on:{\"click\":_vm.save}},[_vm._v(\"Сохранить\")]),_vm._v(\" \"+_vm._s(_vm.saveStatus)+\" \")],1):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <h3>Загрузить товары</h3>\n    <div>\n      <div>\n        <v-select\n          v-model=\"idProvider\"\n          :items=\"providers\"\n          item-text=\"nameProvider\"\n          item-value=\"id\"\n          persistent-hint\n          return-object\n          single-line\n          label=\"Провайдер\"\n          @change=\"reset\"\n        ></v-select>\n      </div>\n      <label\n        >File\n        <input\n          type=\"file\"\n          id=\"file\"\n          ref=\"file\"\n          @change=\"handleFileUpload($event)\"\n        />\n      </label>\n      <div class=\"my-10\">\n        <v-btn :disabled=\"!this.file\" v-on:click=\"submitFile()\">Submit</v-btn>\n        {{ showStatus }}\n      </div>      \n    </div>\n    <div v-if=\"contentFile\">\n      <h3>Products from files</h3>\n      <div>\n          <v-data-table\n            v-if=\"idProvider && headers && contentFile\"\n            :headers=\"headers\"\n            :items=\"contentFile\"\n            :items-per-page=\"5\"\n            class=\"elevation-1\"\n        ></v-data-table>\n      </div>\n      <v-btn\n        class=\"mt-10\"\n        color=\"primary\"\n        @click=\"save\"\n      >Сохранить</v-btn>\n      {{ saveStatus }}\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport { mapGetters } from \"vuex\";\n\nexport default {\n  name: \"AddProducts\",\n  components: {},\n  data() {\n    return {\n      file: null,\n      readFromFile: null,\n      added: null,\n      error: null,\n      idProvider: null,\n      contentFile: null,\n      providers: null,\n      showStatus: null,\n      saveStatus: null\n    };\n  },\n  computed: {\n    ...mapGetters([\"doubleCount\"]),\n    provider() {\n      if (!this.idProvider\n      || !this.idProvider.id\n      || !this.providers) {\n        return null;\n      }\n      let provider = null;\n      this.providers.forEach((obj) => {\n        if (obj.id === this.idProvider.id) {\n          provider = obj;\n        }\n      });\n      return provider;\n    },\n    headers() {\n      if (!this.provider\n      || !this.provider.fieldsNames) {\n        return null;\n      }\n      const fields = JSON.parse(this.provider.fieldsNames);\n      // const fields = [\n      //     'idProductProvider',\n      //     'name',\n      //     'price',\n      //     'count'\n      //   ];\n      return fields.map((el) => ({\n        text: el,\n        align: 'start',\n        value: el,\n      }));\n    }\n  },\n  mounted() {\n    axios\n        .get(\"http://localhost:3000/api/getProviders\", {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\",\n          },\n        })\n        .then((result) => {\n          if (\n            result &&\n            result.data && \n            result.data.data\n          ) {\n            this.providers = result.data.data;\n          }\n        })\n        .catch(() => {\n          console.log(\"ERROR\");\n          this.providers = null;\n        });\n  },\n  methods: {\n    handleFileUpload() {\n      this.file = this.$refs.file.files[0];\n    },\n    submitFile() {\n      this.error = null;\n      this.readFromFile = null;\n      this.added = null;\n      let formData = new FormData();\n      console.log(this.file);\n      formData.append(\"file1\", this.file);\n      formData.append(\"idProvider\", this.idProvider && this.idProvider.id);\n      axios\n        .post(\"http://localhost:3000/api/readProviderFile\", formData, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\",\n          },\n        })\n        .then((result) => {\n          console.log(result.data.readFromFile);\n          console.log(\"SUCCESS\");\n          this.showStatus = 'Успешно загружен файл';\n          this.contentFile = result && result.data;\n        })\n        .catch(() => {\n          console.log(\"ERROR\");\n          this.showStatus = 'Ошиюка загрузки файла';\n          this.contentFile = null;\n        });\n    },\n    save() {\n      if (!this.contentFile) {\n        console.log('empty content');\n      }\n      \n      axios\n        .post(\"http://localhost:3000/api/addProviderProducts\", {\n            rows: this.contentFile.map((row) => {\n              const fields = JSON.parse(this.provider.fieldsNames);\n              return {\n                ...row,\n                idProductProvider: row['innerId'],\n                values: JSON.stringify(fields.map((el) => (row[el])))\n              };\n            })          \n          }, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        })\n        .then((result) => {\n          console.log(\"SUCCESS\");\n          this.saveStatus = 'Успешно сохранено' + JSON.stringify(result && result.data, null, 2);\n          console.log(result);\n          // this.contentFile = result && result.data;\n        })\n        .catch(() => {\n          console.log(\"ERROR\");\n          this.saveStatus = 'Ошибка при сохранении';\n          // this.contentFile = null;\n        });\n    },\n    reset() {\n       this.showStatus = '';\n       this.saveStatus = '';\n       this.contentFile = null;\n    }\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AddAllProducts.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AddAllProducts.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./AddAllProducts.vue?vue&type=template&id=1331b232&\"\nimport script from \"./AddAllProducts.vue?vue&type=script&lang=js&\"\nexport * from \"./AddAllProducts.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\ninstallComponents(component, {VBtn,VDataTable,VSelect})\n"],"sourceRoot":""}