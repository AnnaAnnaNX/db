{"version":3,"sources":["webpack:///./src/views/MainAssortiment.vue?3443","webpack:///src/views/MainAssortiment.vue","webpack:///./src/views/MainAssortiment.vue?52cc","webpack:///./src/views/MainAssortiment.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","_v","tableInfo","rows","attrs","headers","scopedSlots","_u","key","fn","ref","item","_s","id","concat","mainProducts","map","el","on","val","select","_e","error","staticRenderFns","name","components","data","providerProducts","providers","shortListHeaders","showNotLinkedProduct","computed","mainIds","forEach","provider","nameProviderIdProviderObj","nameProvider","fieldsNames","JSON","parse","idProviderNameProviderObj","idMainProduct","obj","idProductProvider","values","n","updatedAt","console","log","list","mounted","products","methods","handleFileUpload","file","$refs","files","row","idProvider","writeRowsInExcel","component","VDataTable","VSelect"],"mappings":"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","file":"js/chunk-2d0b2c81.74e343b7.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('h3',[_vm._v(\"Основной ассортимент\")]),(_vm.tableInfo && _vm.tableInfo.rows)?_c('v-data-table',{attrs:{\"headers\":_vm.headers,\"items\":_vm.tableInfo.rows},scopedSlots:_vm._u([{key:\"item.id\",fn:function(ref){\nvar item = ref.item;\nreturn [(item.id)?_c('div',[_vm._v(\" \"+_vm._s(item.id)+\" \")]):_c('div',[_c('v-select',{attrs:{\"items\":['New' ].concat( _vm.mainProducts.map(function (el) { return (el.id); })),\"label\":\"Связать\"},on:{\"change\":function (val) {_vm.select(val, item)}}})],1)]}}],null,false,3933829408)}):_vm._e(),(_vm.error !== null)?_c('div',[_vm._v(\"Error - \"+_vm._s(_vm.error))]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <h3>Основной ассортимент</h3>\r\n    <v-data-table\r\n      v-if=\"tableInfo && tableInfo.rows\"\r\n      :headers=\"headers\"\r\n      :items=\"tableInfo.rows\"\r\n    >\r\n      <template v-slot:item.id=\"{ item }\">\r\n        <div v-if=\"item.id\">\r\n          {{ item.id }}\r\n        </div>\r\n        <div v-else>\r\n          <v-select\r\n            :items=\"['New', ...mainProducts.map((el) => (el.id))]\"\r\n            label=\"Связать\"\r\n            @change=\"(val) => {select(val, item)}\"\r\n          ></v-select>\r\n        </div>\r\n      </template>\r\n    </v-data-table>\r\n    <div v-if=\"error !== null\">Error - {{ error }}</div>\r\n    <!-- <v-btn @click=\"writeRowsInExcel\" color=\"primary\">Выгрузить в Excel</v-btn> -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n  name: \"MainAssortiment\",\r\n  components: {},\r\n  data() {\r\n    return {\r\n      providerProducts: null,\r\n      mainProducts: null,\r\n      providers: null,\r\n      error: null,\r\n      shortListHeaders: true,\r\n      showNotLinkedProduct: null\r\n    };\r\n  },\r\n  // column name - <имя поля> #<idProvider>\r\n  computed: {\r\n    // headers\r\n    tableInfo() {\r\n      if (!this.mainProducts || !this.providerProducts || !this.providers) {\r\n        return null;\r\n      }\r\n      const mainIds = this.mainProducts.map((el) => (el.id));\r\n      const obj = {};\r\n      mainIds.forEach((el) => {obj[el] = {}});\r\n      // иметь сопоставление idProvider с именем провайдера\r\n      // nameProviderIdProviderObj {idProvider: nameProvider}\r\n      const nameProviderIdProviderObj = {};\r\n      this.providers.forEach((provider) => {\r\n        if (provider.id) {\r\n          nameProviderIdProviderObj[provider.nameProvider] = {\r\n            id: provider.id,\r\n            fieldsNames: provider.fieldsNames && JSON.parse(provider.fieldsNames)\r\n          };\r\n        }\r\n      });\r\n      const idProviderNameProviderObj = {};\r\n      this.providers.forEach((provider) => {\r\n        if (provider.id && provider.nameProvider) {\r\n          idProviderNameProviderObj[provider.id] = provider.nameProvider;\r\n        }\r\n      });\r\n      this.providerProducts.forEach((el) => {\r\n        if (el.idMainProduct) {\r\n          // obj[idMainProduct][`count #${el.idProvider}`] = el.count;\r\n          \r\n          if (nameProviderIdProviderObj['YM'] &&\r\n            (el.idProvider === nameProviderIdProviderObj['YM'].id)) {\r\n            obj[el.idMainProduct]['YMId'] = el.idProductProvider;\r\n            const fieldsNames = nameProviderIdProviderObj['YM'].fieldsNames;\r\n            const n = fieldsNames.indexOf('name');\r\n            const values = el.values && JSON.parse(el.values);\r\n            obj[el.idMainProduct]['YMName'] = values && values[n];\r\n          } else\r\n          if (nameProviderIdProviderObj['Ozon'] &&\r\n            (el.idProvider === nameProviderIdProviderObj['Ozon'].id)) {\r\n            obj[el.idMainProduct]['OzonId'] = el.idProductProvider;\r\n            const fieldsNames = nameProviderIdProviderObj['Ozon'].fieldsNames;\r\n            const n = fieldsNames.indexOf('name');\r\n            const values = el.values && JSON.parse(el.values); \r\n            obj[el.idMainProduct]['OzonName'] = values && values[n];\r\n          } else\r\n          if (nameProviderIdProviderObj['1C'] &&\r\n            (el.idProvider === nameProviderIdProviderObj['1C'].id)) {\r\n            obj[el.idMainProduct]['1CId'] = el.idProductProvider;\r\n            const values = el.values && JSON.parse(el.values); \r\n            const fieldsNames = nameProviderIdProviderObj['1C'].fieldsNames;\r\n            let n = fieldsNames.indexOf('name');\r\n            obj[el.idMainProduct]['1CName'] = values && values[n];\r\n            n = fieldsNames.indexOf('price');\r\n            obj[el.idMainProduct]['1CPrice'] = values && values[n];\r\n            obj[el.idMainProduct]['1CUpdate'] = el.updatedAt;\r\n          } else    \r\n          if (nameProviderIdProviderObj['markup'] &&\r\n            (el.idProvider === nameProviderIdProviderObj['markup'].id)) {\r\n            obj[el.idMainProduct]['markupId'] = el.idProductProvider;\r\n            const values = el.values && JSON.parse(el.values);\r\n            const fieldsNames = nameProviderIdProviderObj['markup'].fieldsNames;\r\n            let n = fieldsNames.indexOf('markup');\r\n            obj[el.idMainProduct]['markup'] = values && values[n];\r\n          } else\r\n          // здесь только поставщики (берем любого поставщика)\r\n          if (!obj[el.idMainProduct]['providerName']) {            \r\n            console.log('el.idProvider');\r\n            console.log(el.idProvider);\r\n            const providerName = idProviderNameProviderObj[el.idProvider];\r\n            console.log('providerName');\r\n            console.log(providerName);\r\n            obj[el.idMainProduct]['providerName'] = providerName;\r\n            const fieldsNames = nameProviderIdProviderObj[providerName]\r\n            && nameProviderIdProviderObj[providerName].fieldsNames;\r\n            let n = fieldsNames && fieldsNames.indexOf('name');\r\n            const values = el.values && JSON.parse(el.values); \r\n            obj[el.idMainProduct]['providerProductName'] = values && values[n];\r\n            n = fieldsNames && fieldsNames.indexOf('price');\r\n            obj[el.idMainProduct]['providerProductprice'] = values && values[n];\r\n            obj[el.idMainProduct]['providerProductUpdate'] = el.updatedAt;\r\n          }\r\n        }\r\n      });\r\n      const rows = Object.keys(obj).map((id) => ({id: id, ...obj[id]}));\r\n      console.log('rows');\r\n      console.log(rows);\r\n      const shortListHeaders = [\r\n        'YMId',\r\n        'YMName',\r\n        'OzonId',\r\n        'OzonName',\r\n        '1CId',\r\n        '1CName',\r\n        '1CPrice',\r\n        '1CUpdate',\r\n        'markupId',\r\n        'markup',\r\n        'providerName',\r\n        'providerProductName',\r\n        'providerProductprice',\r\n        'providerProductUpdate'\r\n      ];\r\n\r\n      return {\r\n        rows,\r\n        shortListHeaders: ['id', ...shortListHeaders],\r\n      };\r\n    },\r\n    headers() {\r\n      if (!this.tableInfo) {\r\n        return null;\r\n      }\r\n      let list = this.tableInfo.shortListHeaders;\r\n      return list.map((el) => ({\r\n        text: el,\r\n        align: 'start',\r\n        value: el,\r\n      }));\r\n    }\r\n  },\r\n  mounted() {\r\n    console.log(\"MOUNTED\");\r\n    this.products = null;\r\n    this.error = null;\r\n    axios\r\n      .get(\"http://localhost:3000/api/getProviderProducts\")\r\n      .then((result) => {\r\n        console.log(\"SUCCESS\");\r\n        if (result && result.data && result.data.data) {\r\n          this.providerProducts = result.data.data;\r\n        }\r\n      })\r\n      .catch(() => {\r\n        console.log(\"ERROR\");\r\n        this.providerProducts = null;\r\n      });\r\n    axios\r\n      .get(\"http://localhost:3000/api/getMainProducts\")\r\n      .then((result) => {\r\n        console.log(\"SUCCESS\");\r\n        if (result && result.data && result.data.data) {\r\n          this.mainProducts = result.data.data;\r\n        }\r\n      })\r\n      .catch(() => {\r\n        console.log(\"ERROR\");\r\n        this.mainProducts = null;\r\n      });\r\n    axios\r\n      .get(\"http://localhost:3000/api/getProviders\", {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n        },\r\n      })\r\n      .then((result) => {\r\n        if (\r\n          result &&\r\n          result.data && \r\n          result.data.data\r\n        ) {\r\n          this.providers = result.data.data;\r\n        }\r\n      })\r\n      .catch(() => {\r\n        console.log(\"ERROR\");\r\n        this.providers = null;\r\n      });\r\n  },\r\n  methods: {\r\n    handleFileUpload() {\r\n      this.file = this.$refs.file.files[0];\r\n    },\r\n    select(val, row) {\r\n      console.log(val);\r\n      console.log(row);\r\n    //  idProvider || !idProductProvider || !idMainProduct\r\n      if (!this.showNotLinkedProduct) {\r\n        return 'error';\r\n      }\r\n      const idProductProvider = row[`id #${this.showNotLinkedProduct}`];\r\n      const idProvider = this.showNotLinkedProduct;\r\n      const obj = {\r\n        idProductProvider,\r\n        idProvider,\r\n      };\r\n      if (val !== 'New') {\r\n        obj.idMainProduct = val;\r\n      }\r\n      axios\r\n        .post(\"http://localhost:3000/api/addLink\", obj, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        })\r\n        .then(() => {\r\n          console.log(\"SUCCESS\");\r\n          alert('Связан');\r\n        })\r\n        .catch(() => {\r\n          console.log(\"ERROR\");\r\n          alert('Ошибка');\r\n        });\r\n    },\r\n    writeRowsInExcel() {\r\n      axios\r\n        .post(\"http://localhost:3000/api/writeRowsInExcel\", \r\n        { \r\n          headers: this.headers,\r\n          rows: [\r\n            ...this.tableInfo.rows, \r\n            ...this.tableInfo.notLinkedRows\r\n          ]\r\n        }, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        })\r\n        .then(() => {\r\n          console.log(\"SUCCESS\");\r\n        })\r\n        .catch(() => {\r\n          console.log(\"ERROR\");\r\n        });\r\n    }\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MainAssortiment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MainAssortiment.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MainAssortiment.vue?vue&type=template&id=024c4d1f&\"\nimport script from \"./MainAssortiment.vue?vue&type=script&lang=js&\"\nexport * from \"./MainAssortiment.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\ninstallComponents(component, {VDataTable,VSelect})\n"],"sourceRoot":""}